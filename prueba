import pygame
import random

# Inicializar Pygame
pygame.init()

# Pantalla
ANCHO = 700
ALTO = 500
pantalla = pygame.display.set_mode((ANCHO, ALTO))
pygame.display.set_caption("Juego de Pesca - Escape y Captura")

# Colores
AZUL = (0, 100, 255)
NEGRO = (0, 0, 0)
BLANCO = (255, 255, 255)
ROJO = (255, 0, 0)
VERDE = (0, 255, 0)
AMARILLO = (255, 255, 0)
GRIS = (200, 200, 200)
NARANJA = (255, 165, 0)
PURPLE = (160, 32, 240)

# Cargar imágenes
anzuelo_img = pygame.image.load("imagenes/anzuelo.png")
pez_imgs = {
    "extrachico": pygame.image.load("imagenes/pez_extrachico.png"),
    "chico": pygame.image.load("imagenes/pez_chico.png"),
    "mediano": pygame.image.load("imagenes/pez_mediano.png"),
    "normal": pygame.image.load("imagenes/pez_normal.png"),
    "grande": pygame.image.load("imagenes/pez_grande.png"),
    "extragrande": pygame.image.load("imagenes/pez_extragrande.png")
}

# Redimensionar imágenes (si es necesario)
anzuelo_img = pygame.transform.scale(anzuelo_img, (10, 10))  # Ajustar tamaño del anzuelo

# Variables del anzuelo
anzuelo_x = ANCHO // 2
anzuelo_y = 50
anzuelo_vel = 5
anzuelo_ancho = 10
anzuelo_alto = 10
anzuelo_max_y = ALTO - 30

# Tipos de peces
TIPOS_PEZ = {
    "extrachico": {"color": VERDE, "resistencia": 2, "vel_barra": 2, "puntos": 1},
    "chico": {"color": AMARILLO, "resistencia": 3, "vel_barra": 3, "puntos": 2},
    "mediano": {"color": NARANJA, "resistencia": 5, "vel_barra": 4, "puntos": 3},
    "normal": {"color": GRIS, "resistencia": 6, "vel_barra": 4, "puntos": 4},
    "grande": {"color": ROJO, "resistencia": 8, "vel_barra": 5, "puntos": 5},
    "extragrande": {"color": PURPLE, "resistencia": 10, "vel_barra": 6, "puntos": 7},
}

# Peces
num_peces = 6
peces = []
for _ in range(num_peces):
    tipo = random.choice(list(TIPOS_PEZ.keys()))
    peces.append({
        "x": random.randint(0, ANCHO-30),
        "y": random.randint(150, ALTO-30),
        "vel": random.randint(2, 4),
        "tipo": tipo,
        "capturado": False,
        "resistencia": TIPOS_PEZ[tipo]["resistencia"]
    })

# Barra de captura
capturando = False
barra_x = 150
barra_ancho = 300
barra_alto = 30
barra_pos = barra_x
barra_direccion = 1
pe_anzuelo = None
zona_ancho_inicial = 60
zona_ancho = zona_ancho_inicial

hits = 0
zona_pos = random.randint(barra_x, barra_x + barra_ancho - zona_ancho)
puntaje = 0
fuente = pygame.font.SysFont(None, 30)

click_cooldown = 0.15
tiempo_ultimo_click = 0

reloj = pygame.time.Clock()
jugando = True

mensaje_escape_tiempo = 0
mensaje_escape = None

while jugando:
    dt = reloj.tick(60) / 1000
    tiempo_ultimo_click -= dt
    if mensaje_escape_tiempo > 0:
        mensaje_escape_tiempo -= dt
        if mensaje_escape_tiempo <= 0:
            mensaje_escape = None

    pantalla.fill(AZUL)

    # Eventos
    for evento in pygame.event.get():
        if evento.type == pygame.QUIT:
            jugando = False
    
    teclas = pygame.key.get_pressed()

    # Mover anzuelo libremente
    if not capturando:
        if teclas[pygame.K_LEFT] and anzuelo_x > 0:
            anzuelo_x -= anzuelo_vel
        if teclas[pygame.K_RIGHT] and anzuelo_x < ANCHO - anzuelo_ancho:
            anzuelo_x += anzuelo_vel
        if teclas[pygame.K_UP] and anzuelo_y > 0:
            anzuelo_y -= anzuelo_vel
        if teclas[pygame.K_DOWN] and anzuelo_y < anzuelo_max_y:
            anzuelo_y += anzuelo_vel

    # Dibujar hilo y anzuelo (Usando la imagen del anzuelo)
    pantalla.blit(anzuelo_img, (anzuelo_x, anzuelo_y))

    # Dibujar y mover peces (Usando las imágenes de los peces)
    for pez in peces:
        if not pez["capturado"]:
            tipo_pez = pez["tipo"]
            pantalla.blit(pez_imgs[tipo_pez], (pez["x"], pez["y"]))
        
        # Colisión con anzuelo
        if not capturando and pez["y"] < anzuelo_y + anzuelo_alto < pez["y"] + 15 and pez["x"] < anzuelo_x + anzuelo_ancho < pez["x"] + 30:
            capturando = True
            pez["capturado"] = True
            barra_pos = barra_x
            barra_direccion = 1
            zona_ancho = zona_ancho_inicial
            zona_pos = random.randint(barra_x, barra_x + barra_ancho - zona_ancho)
            pe_anzuelo = pez
            hits = 0
    
    # Captura con barra horizontal
    if capturando and pe_anzuelo:
        vel_barra = TIPOS_PEZ[pe_anzuelo["tipo"]]["vel_barra"]
        barra_pos += barra_direccion * vel_barra
        if barra_pos <= barra_x:
            barra_pos = barra_x
            barra_direccion = 1
        elif barra_pos >= barra_x + barra_ancho - 10:
            barra_pos = barra_x + barra_ancho - 10
            barra_direccion = -1
        
        mouse_click = pygame.mouse.get_pressed()[0]
        if mouse_click and tiempo_ultimo_click <= 0:
            tiempo_ultimo_click = click_cooldown
            if zona_pos <= barra_pos <= zona_pos + zona_ancho:
                hits += 1
                # Mover y achicar zona
                zona_pos = random.randint(barra_x, barra_x + barra_ancho - zona_ancho)
                zona_ancho = max(20, zona_ancho - 3)
            else:
                hits -= 1
                if hits <= 0:
                    # Pez se ha escapado
                    mensaje_escape = fuente.render("¡Se ha escapado!", True, ROJO)
                    mensaje_escape_tiempo = 1.5
                    capturando = False
                    # Reiniciar pez
                    pe_anzuelo["capturado"] = False
                    pe_anzuelo["x"] = random.randint(0, ANCHO-30)
                    pe_anzuelo["y"] = random.randint(150, ALTO-30)
                    pe_anzuelo["tipo"] = random.choice(list(TIPOS_PEZ.keys()))
                    pe_anzuelo["resistencia"] = TIPOS_PEZ[pe_anzuelo["tipo"]]["resistencia"]
                    hits = 0
        
        # Captura exitosa
        if hits >= pe_anzuelo["resistencia"]:
            puntaje += TIPOS_PEZ[pe_anzuelo["tipo"]]["puntos"]
            capturando = False
            pe_anzuelo["capturado"] = False
            pe_anzuelo["x"] = random.randint(0, ANCHO-30)
            pe_anzuelo["y"] = random.randint(150, ALTO-30)
            pe_anzuelo["tipo"] = random.choice(list(TIPOS_PEZ.keys()))
            pe_anzuelo["resistencia"] = TIPOS_PEZ[pe_
